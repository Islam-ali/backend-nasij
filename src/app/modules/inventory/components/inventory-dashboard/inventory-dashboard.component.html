<div class="inventory-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="fas fa-chart-line"></i>
        لوحة تحكم المخزون والمحاسبة
      </h1>
      <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
        تحديث البيانات
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>جاري تحميل البيانات...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="refreshData()">إعادة المحاولة</button>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error && dashboardData" class="dashboard-content">
    
    <!-- Key Metrics Cards -->
    <div class="metrics-grid">
      <!-- Revenue Card -->
      <div class="metric-card revenue-card">
        <div class="metric-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-title">إجمالي الإيرادات</h3>
          <p class="metric-value">{{ dashboardData.monthlyProfit?.revenue | currency:'EGP':'symbol':'1.0-0' }}</p>
          <p class="metric-period">هذا الشهر</p>
        </div>
      </div>

      <!-- Net Profit Card -->
      <div class="metric-card profit-card">
        <div class="metric-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-title">صافي الربح</h3>
          <p class="metric-value" [style.color]="getProfitColor(dashboardData.monthlyProfit?.netProfit ?? 0)">
            {{ dashboardData.monthlyProfit?.netProfit | currency:'EGP':'symbol':'1.0-0' }}
          </p>
          <p class="metric-period">هذا الشهر</p>
        </div>
      </div>

      <!-- Profit Margin Card -->
      <div class="metric-card margin-card">
        <div class="metric-icon">
          <i class="fas fa-percentage"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-title">هامش الربح</h3>
          <p class="metric-value" [style.color]="getProfitColor(dashboardData.monthlyProfit?.profitMargin ?? 0)">
            {{ dashboardData.monthlyProfit?.profitMargin | number:'1.1-1' }}%
          </p>
          <p class="metric-period">هذا الشهر</p>
        </div>
      </div>

      <!-- Low Stock Alert Card -->
      <div class="metric-card alert-card">
        <div class="metric-icon" [style.color]="getStockAlertColor(dashboardData.lowStockProducts)">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-title">منتجات منخفضة المخزون</h3>
          <p class="metric-value" [style.color]="getStockAlertColor(dashboardData.lowStockProducts)">
            {{ dashboardData.lowStockProducts }}
          </p>
          <p class="metric-period">تحتاج إعادة طلب</p>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <!-- Profit Overview Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>نظرة عامة على الأرباح</h3>
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color" style="background-color: #4CAF50;"></span>
              <span>الإيرادات</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background-color: #F44336;"></span>
              <span>المصروفات</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background-color: #2196F3;"></span>
              <span>صافي الربح</span>
            </div>
          </div>
        </div>
        <div class="chart-content">
          <div class="profit-bars">
            <p-chart [type]="'line'" [data]="data" [options]="options"></p-chart>  
            <!-- <div *ngFor="let item of profitChartData" class="profit-bar">
              <div class="bar-label">{{ item.name }}</div>
              <div class="bar-container">
                <div class="bar" 
                     [style.width.%]="getBarPercentage(item.value)"
                     [style.background-color]="item.color">
                  <span class="bar-value">{{ item.value | currency:'EGP':'symbol':'1.0-0' }}</span>
                </div>
              </div>
            </div> -->
          </div>
        </div>
      </div>

      <!-- Top Selling Products -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>أفضل المنتجات مبيعاً</h3>
        </div>
        <div class="chart-content">
          <div class="top-products-list">
            <div *ngFor="let product of topProductsChartData; let i = index" class="product-item">
              <div class="product-rank">{{ i + 1 }}</div>
              <div class="product-info">
                <h4 class="product-name">{{ product.name }}</h4>
                <p class="product-details">
                  الكمية المباعة: {{ product.value }} | 
                  الإيرادات: {{ product.revenue | currency:'EGP':'symbol':'1.0-0' }}
                </p>
              </div>
              <div class="product-profit" [style.color]="getProfitColor(product.profit)">
                {{ product.profit | currency:'EGP':'symbol':'1.0-0' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions-section">
      <h3>إجراءات سريعة</h3>
      <div class="actions-grid">
        <button class="action-btn" routerLink="/inventory/stock">
          <i class="fas fa-boxes"></i>
          <span>إدارة المخزون</span>
        </button>
        <button class="action-btn" routerLink="/inventory/expenses">
          <i class="fas fa-receipt"></i>
          <span>إدارة المصروفات</span>
        </button>
        <button class="action-btn" routerLink="/inventory/reports">
          <i class="fas fa-chart-bar"></i>
          <span>التقارير المالية</span>
        </button>
        <button class="action-btn" routerLink="/inventory/quick-actions">
          <i class="fas fa-bolt"></i>
          <span>إجراءات سريعة</span>
        </button>
      </div>
    </div>
  </div>
</div> 