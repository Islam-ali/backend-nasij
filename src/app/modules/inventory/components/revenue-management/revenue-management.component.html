<div class="p-6 bg-gray-50 min-h-screen">
  <!-- Toast for notifications -->
  <p-toast></p-toast>

  <!-- Header Section -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">إدارة الإيرادات</h1>
    <p class="text-gray-600">عرض وإدارة جميع الإيرادات والمدفوعات</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <p-card class="shadow-lg">
      <div class="text-center">
        <div class="text-2xl font-bold text-green-600">{{ getTotalRevenue() | currencyFormat }}</div>
        <div class="text-gray-600 mt-1">إجمالي الإيرادات</div>
      </div>
    </p-card>

    <p-card class="shadow-lg">
      <div class="text-center">
        <div class="text-2xl font-bold text-blue-600">{{ revenues.length }}</div>
        <div class="text-gray-600 mt-1">عدد المعاملات</div>
      </div>
    </p-card>

    <p-card class="shadow-lg">
      <div class="text-center">
        <div class="text-2xl font-bold text-purple-600">{{ (getTotalRevenue() / revenues.length) || 0 | currencyFormat }}</div>
        <div class="text-gray-600 mt-1">متوسط الإيراد</div>
      </div>
    </p-card>
  </div>

  <!-- Filters Section -->
  <p-card class="mb-6 shadow-lg">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Date Range Filters -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-gray-700">من تاريخ</label>
        <p-calendar 
          [(ngModel)]="filters.startDate" 
          [showIcon]="true"
          dateFormat="dd/mm/yy"
          placeholder="اختر التاريخ"
          class="w-full">
        </p-calendar>
      </div>

      <div class="space-y-2">
        <label class="block text-sm font-medium text-gray-700">إلى تاريخ</label>
        <p-calendar 
          [(ngModel)]="filters.endDate" 
          [showIcon]="true"
          dateFormat="dd/mm/yy"
          placeholder="اختر التاريخ"
          class="w-full">
        </p-calendar>
      </div>

      <!-- Category Filter -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-gray-700">الفئة</label>
        <p-dropdown 
          [(ngModel)]="filters.category" 
          [options]="categoryOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="اختر الفئة"
          class="w-full">
        </p-dropdown>
      </div>

      <!-- Payment Method Filter -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-gray-700">طريقة الدفع</label>
        <p-dropdown 
          [(ngModel)]="filters.paymentMethod" 
          [options]="paymentMethodOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="اختر طريقة الدفع"
          class="w-full">
        </p-dropdown>
      </div>
    </div>

    <!-- Filter Actions -->
    <div class="flex gap-3 mt-4">
      <p-button 
        label="تطبيق الفلاتر" 
        icon="pi pi-filter" 
        (onClick)="applyFilters()"
        [loading]="loading"
        >
      </p-button>
      
      <p-button 
        label="مسح الفلاتر" 
        icon="pi pi-times" 
        (onClick)="clearFilters()"
        severity="secondary"
        >
      </p-button>

      <p-button 
        label="إعادة حساب الإيرادات" 
        icon="pi pi-refresh" 
        (onClick)="recalculateRevenue()"
        [loading]="recalculating"
        severity="success"
        >
      </p-button>
    </div>
  </p-card>

  <!-- Revenue Table -->
  <p-card class="shadow-lg">
    <div class="relative">
      <!-- Loading Overlay -->
      <div *ngIf="loading" class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10">
        <p-progressSpinner></p-progressSpinner>
      </div>

      <!-- Table -->
      <p-table 
        [value]="revenues" 
        [paginator]="false"
        [rows]="pageSize"
        [showCurrentPageReport]="false"
        [tableStyle]="{'min-width': '50rem'}"
        styleClass="p-datatable-sm"
        [loading]="loading"
        responsiveLayout="scroll">
        
        <!-- Title Column -->
        <ng-template pTemplate="header">
          <tr>
            <th class="text-right p-3 bg-gray-50 border-b">العنوان</th>
            <th class="text-right p-3 bg-gray-50 border-b">المبلغ</th>
            <th class="text-right p-3 bg-gray-50 border-b">الفئة</th>
            <th class="text-right p-3 bg-gray-50 border-b">طريقة الدفع</th>
            <th class="text-right p-3 bg-gray-50 border-b">التاريخ</th>
            <th class="text-right p-3 bg-gray-50 border-b">رقم الطلب</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-revenue>
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="p-3 border-b">
              <div class="font-medium text-gray-900">{{ revenue.title }}</div>
              <div *ngIf="revenue.description" class="text-sm text-gray-500 mt-1">
                {{ revenue.description }}
              </div>
            </td>
            
            <td class="p-3 border-b">
              <div class="font-bold text-green-600">
                {{ revenue.amount | currencyFormat }}
              </div>
            </td>
            
            <td class="p-3 border-b">
              <p-tag 
                [value]="revenue.category | categoryLabel"
                [severity]="revenue.category | severityColor:'category'"
                class="text-xs">
              </p-tag>
            </td>
            
            <td class="p-3 border-b">
              <p-tag 
                [value]="revenue.paymentMethod"
                [severity]="revenue.paymentMethod | severityColor:'payment'"
                class="text-xs">
              </p-tag>
            </td>
            
            <td class="p-3 border-b">
              <div class="text-gray-700">
                {{ revenue.revenueDate | dateFormat }}
              </div>
            </td>
            
            <td class="p-3 border-b">
              <div *ngIf="revenue.orderNumber" class="text-blue-600 font-medium">
                {{ revenue.orderNumber }}
              </div>
              <div *ngIf="!revenue.orderNumber" class="text-gray-400">
                -
              </div>
            </td>
          </tr>
        </ng-template>

        <!-- Empty State -->
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center p-8">
              <div class="text-gray-500">
                <i class="pi pi-inbox text-4xl mb-4 block"></i>
                <p class="text-lg font-medium">لا توجد إيرادات</p>
                <p class="text-sm">لم يتم العثور على أي إيرادات تطابق الفلاتر المحددة</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>

      <!-- Pagination -->
      <div class="mt-4 flex justify-between items-center">
        <div class="text-sm text-gray-600">
          عرض {{ (currentPage - 1) * pageSize + 1 }} إلى {{ Math.min(currentPage * pageSize, totalItems) }} من {{ totalItems }} نتيجة
        </div>
        
        <p-paginator 
          [rows]="pageSize"
          [totalRecords]="totalItems"
          [rowsPerPageOptions]="[5, 10, 20, 50]"
          (onPageChange)="onPageChange($event)"
          [showCurrentPageReport]="false"
          [showFirstLastIcon]="true"
          [showPageLinks]="true"
          class="bg-white">
        </p-paginator>
      </div>
    </div>
  </p-card>
</div> 