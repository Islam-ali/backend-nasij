<div class="card">
    <p-toast></p-toast>

    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center">
                    <i class="pi {{ isEditMode ? 'pi-pencil' : 'pi-sparkles' }} text-white text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 m-0">
                        {{ isEditMode ? ('heroLayout.editHeroLayout' | translate) : ('heroLayout.createNewHeroLayout' | translate) }}
                    </h2>
                    <p class="text-gray-600 mt-1 mb-0">
                        {{ isEditMode ? ('heroLayout.updateHeroLayoutSettings' | translate) : ('heroLayout.designBeautifulHeroSection' | translate) }}
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                @if(itemsArray.length > 0) {
                <div class="px-4 py-2 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2">
                    <i class="pi pi-check-circle text-green-600"></i>
                    <span class="text-green-800 font-medium">{{ itemsArray.length }} {{ itemsArray.length === 1 ? ('heroLayout.item' | translate) : ('heroLayout.items' | translate) }}</span>
                </div>
                }
                <p-button [label]="'common.cancel' | translate" icon="pi pi-times" [text]="true" (onClick)="cancel()"></p-button>
            </div>
        </div>
    </div>

    <!-- Form Content -->
    <form [formGroup]="heroLayoutForm">
        <p-tabView>
            
            <!-- Basic Info Tab -->
            <p-tabPanel [header]="'heroLayout.basicInfo' | translate" leftIcon="pi pi-info-circle">
                <div class="grid grid-cols-1 gap-6 p-6">
                    
                    <!-- Name -->
                    <div class="field">
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ 'heroLayout.layoutName' | translate }} <small class="text-gray-500">({{ 'heroLayout.optionalUniqueIdentifier' | translate }})</small>
                        </label>
                        <input id="name" pInputText type="text" formControlName="name" 
                               [placeholder]="'heroLayout.layoutNamePlaceholder' | translate" 
                               class="w-full" />
                    </div>

                    <!-- Section Title -->
                    <div class="field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.sectionTitle' | translate }}</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="sectionTitle">
                            <div>
                                <label for="sectionTitleEn" class="block text-xs text-gray-600 mb-1">{{ 'common.english' | translate }}</label>
                                <input id="sectionTitleEn" pInputText type="text" formControlName="en" 
                                       [placeholder]="'heroLayout.sectionTitleEnPlaceholder' | translate" class="w-full" dir="ltr" />
                            </div>
                            <div>
                                <label for="sectionTitleAr" class="block text-xs text-gray-600 mb-1">{{ 'common.arabic' | translate }}</label>
                                <input id="sectionTitleAr" pInputText type="text" formControlName="ar" 
                                       [placeholder]="'heroLayout.sectionTitleArPlaceholder' | translate" class="w-full" dir="rtl" />
                            </div>
                        </div>
                    </div>

                    <!-- Section Subtitle -->
                    <div class="field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.sectionSubtitle' | translate }}</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="sectionSubtitle">
                            <div>
                                <label for="subtitleEn" class="block text-xs text-gray-600 mb-1">{{ 'common.english' | translate }}</label>
                                <input id="subtitleEn" pInputText type="text" formControlName="en" 
                                       [placeholder]="'heroLayout.sectionSubtitleEnPlaceholder' | translate" class="w-full" dir="ltr" />
                            </div>
                            <div>
                                <label for="subtitleAr" class="block text-xs text-gray-600 mb-1">{{ 'common.arabic' | translate }}</label>
                                <input id="subtitleAr" pInputText type="text" formControlName="ar" 
                                       [placeholder]="'heroLayout.sectionSubtitleArPlaceholder' | translate" class="w-full" dir="rtl" />
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'common.description' | translate }}</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="description">
                            <div>
                                <label for="descEn" class="block text-xs text-gray-600 mb-1">{{ 'common.english' | translate }}</label>
                                <textarea id="descEn" pInputTextarea formControlName="en" [rows]="3" 
                                          class="w-full" dir="ltr" 
                                          [placeholder]="'heroLayout.optionalDescription' | translate"></textarea>
                            </div>
                            <div>
                                <label for="descAr" class="block text-xs text-gray-600 mb-1">{{ 'common.arabic' | translate }}</label>
                                <textarea id="descAr" pInputTextarea formControlName="ar" [rows]="3" 
                                          class="w-full" dir="rtl" 
                                          [placeholder]="'heroLayout.optionalDescriptionAr' | translate"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Display Order & Tags -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="field">
                            <label for="displayOrder" class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.displayOrder' | translate }}</label>
                            <input id="displayOrder" type="number" pInputText formControlName="displayOrder" class="w-full" />
                        </div>
                        <div class="field">
                            <label for="tags" class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.tags' | translate }}</label>
                            <p-chips id="tags" formControlName="tags" 
                                     [placeholder]="'heroLayout.addTagsPlaceholder' | translate" 
                                     class="w-full"></p-chips>
                        </div>
                    </div>

                </div>
            </p-tabPanel>

            <!-- Items Tab -->
            <p-tabPanel [header]="'heroLayout.items' | translate" leftIcon="pi pi-images">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">{{ 'heroLayout.layoutItems' | translate }}</h3>
                        <p-button [label]="'heroLayout.addItem' | translate" icon="pi pi-plus" (onClick)="addItem()"></p-button>
                    </div>

                    <div formArrayName="items" class="space-y-6">
                        @for (item of itemsArray.controls; track $index; let i = $index) {
                        <p-card [formGroupName]="i" class="relative">
                            <ng-template pTemplate="header">
                                <div class="flex justify-between items-center p-4 bg-gray-50">
                                    <h4 class="text-base font-medium">{{ 'heroLayout.item' | translate }} {{ i + 1 }}</h4>
                                    <p-button icon="pi pi-trash" severity="danger" [text]="true" 
                                              (onClick)="removeItem(i)" 
                                              [disabled]="itemsArray.length === 1"></p-button>
                                </div>
                            </ng-template>

                            <div class="grid grid-cols-1 gap-4">
                                
                                <!-- Active Status -->
                                <div class="field">
                                    <div class="flex items-center">
                                        <p-inputSwitch formControlName="isActive" class="mr-3"></p-inputSwitch>
                                        <label class="text-sm font-medium text-gray-700">
                                            {{ 'heroLayout.itemActiveStatus' | translate }}
                                        </label>
                                    </div>
                                </div>

                                <!-- Image Upload -->
                                <div class="field bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                                    <label class="flex items-center text-base font-semibold text-gray-800 mb-3">
                                        <i class="pi pi-image me-2 text-blue-600"></i>
                                        {{ 'heroLayout.imageUploadOptional' | translate }}
                                    </label>
                                    <p class="text-sm text-gray-600 mb-3">
                                        {{ 'heroLayout.imageUploadDescription' | translate }}
                                    </p>
                                    <app-upload-files
                                        [index]="i"
                                        [control]="item.get('image')!"
                                        [multiple]="false"
                                        [filesServer]="item.get('image')?.value"
                                        [accept]="'image/*'">
                                    </app-upload-files>
                                </div>

                                <!-- Video Upload -->
                                <div class="field bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
                                    <label class="flex items-center text-base font-semibold text-gray-800 mb-3">
                                        <i class="pi pi-video me-2 text-purple-600"></i>
                                        {{ 'heroLayout.videoUploadOptional' | translate }}
                                    </label>
                                    <p class="text-sm text-gray-600 mb-3">
                                        {{ 'heroLayout.videoUploadDescription' | translate }}
                                    </p>
                                    <app-upload-files
                                        [index]="i + 1000"
                                        [control]="item.get('video')!"
                                        [multiple]="false"
                                        [filesServer]="item.get('video')?.value"
                                        [accept]="'video/*'">
                                    </app-upload-files>
                                    
                                    <!-- Video Autoplay Option -->
                                    @if (item.get('video')?.value) {
                                    <div class="mt-4 pt-4 border-t border-purple-300">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                                    {{ 'heroLayout.videoAutoplay' | translate }}
                                                </label>
                                                <p class="text-xs text-gray-500">
                                                    {{ 'heroLayout.videoAutoplayDescription' | translate }}
                                                </p>
                                            </div>
                                            <p-inputSwitch formControlName="videoAutoplay"></p-inputSwitch>
                                        </div>
                                    </div>
                                    }
                                </div>

                                <!-- Title -->
                                <div class="field">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.titleOptional' | translate }}</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" [formGroupName]="'title'">
                                        <input pInputText type="text" formControlName="en" 
                                               [placeholder]="'heroLayout.titleEnPlaceholder' | translate" dir="ltr" />
                                        <input pInputText type="text" formControlName="ar" 
                                               [placeholder]="'heroLayout.titleArPlaceholder' | translate" dir="rtl" />
                                    </div>
                                </div>

                                <!-- Description -->
                                <div class="field">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.descriptionOptional' | translate }}</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" [formGroupName]="'description'">
                                        <textarea pInputTextarea formControlName="en" [rows]="2" 
                                                  [placeholder]="'heroLayout.descriptionEnPlaceholder' | translate" dir="ltr"></textarea>
                                        <textarea pInputTextarea formControlName="ar" [rows]="2" 
                                                  [placeholder]="'heroLayout.descriptionArPlaceholder' | translate" dir="rtl"></textarea>
                                    </div>
                                </div>

                                <!-- Button Text & Link -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="field">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.buttonTextOptional' | translate }}</label>
                                        <div class="grid grid-cols-2 gap-2" [formGroupName]="'buttonText'">
                                            <input pInputText type="text" formControlName="en" 
                                                   [placeholder]="'heroLayout.buttonTextEnPlaceholder' | translate" dir="ltr" />
                                            <input pInputText type="text" formControlName="ar" 
                                                   [placeholder]="'heroLayout.buttonTextArPlaceholder' | translate" dir="rtl" />
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'heroLayout.buttonLinkOptional' | translate }}</label>
                                        <input pInputText type="text" formControlName="buttonLink" 
                                               [placeholder]="'heroLayout.buttonLinkPlaceholder' | translate" class="w-full" />
                                    </div>
                                </div>

                            </div>
                        </p-card>
                        }
                    </div>

                    @if(itemsArray.length === 0) {
                    <div class="text-center py-8 text-gray-500">
                        <i class="pi pi-images text-4xl mb-4"></i>
                        <p>{{ 'heroLayout.noItemsAdded' | translate }}</p>
                    </div>
                    }
                </div>
            </p-tabPanel>

            <!-- Grid Config Tab -->
            <p-tabPanel [header]="'heroLayout.gridLayout' | translate" leftIcon="pi pi-th-large">
                <div class="p-6">
                    <app-hero-grid-builder
                        [collectionsCount]="itemsArray.length"
                        [config]="heroLayoutForm.get('gridConfig')?.value"
                        (configChange)="onGridConfigChange($event)">
                    </app-hero-grid-builder>
                </div>
            </p-tabPanel>

        </p-tabView>
    </form>

    <!-- Footer Actions -->
    <div class="flex justify-end gap-3 mt-6 pt-6 border-t">
        <p-button [label]="'common.cancel' | translate" icon="pi pi-times" [text]="true" (onClick)="cancel()"></p-button>
        <p-button 
            [label]="isEditMode ? ('common.update' | translate) : ('common.create' | translate)" 
            icon="pi pi-check" 
            (onClick)="saveHeroLayout()"
            [loading]="loading()"></p-button>
    </div>

</div>

