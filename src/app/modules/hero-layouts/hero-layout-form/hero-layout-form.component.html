<div class="card">
    <p-toast></p-toast>

    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center">
                    <i class="pi {{ isEditMode ? 'pi-pencil' : 'pi-sparkles' }} text-white text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 m-0">
                        {{ isEditMode ? 'Edit Hero Layout' : 'Create New Hero Layout' }}
                    </h2>
                    <p class="text-gray-600 mt-1 mb-0">
                        {{ isEditMode ? 'Update your hero layout settings' : 'Design a beautiful hero section' }}
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                @if(itemsArray.length > 0) {
                <div class="px-4 py-2 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2">
                    <i class="pi pi-check-circle text-green-600"></i>
                    <span class="text-green-800 font-medium">{{ itemsArray.length }} {{ itemsArray.length === 1 ? 'Item' : 'Items' }}</span>
                </div>
                }
                <p-button label="Cancel" icon="pi pi-times" [text]="true" (onClick)="cancel()"></p-button>
            </div>
        </div>
    </div>

    <!-- Form Content -->
    <form [formGroup]="heroLayoutForm">
        <p-tabView>
            
            <!-- Basic Info Tab -->
            <p-tabPanel header="Basic Info" leftIcon="pi pi-info-circle">
                <div class="grid grid-cols-1 gap-6 p-6">
                    
                    <!-- Name -->
                    <div class="field">
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                            Layout Name <small class="text-gray-500">(Optional - Unique identifier)</small>
                        </label>
                        <input id="name" pInputText type="text" formControlName="name" 
                               placeholder="e.g., home-hero, category-showcase" 
                               class="w-full" />
                    </div>

                    <!-- Section Title -->
                    <div class="field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Section Title</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="sectionTitle">
                            <div>
                                <label for="sectionTitleEn" class="block text-xs text-gray-600 mb-1">English</label>
                                <input id="sectionTitleEn" pInputText type="text" formControlName="en" 
                                       placeholder="e.g., Featured Collections" class="w-full" dir="ltr" />
                            </div>
                            <div>
                                <label for="sectionTitleAr" class="block text-xs text-gray-600 mb-1">العربية</label>
                                <input id="sectionTitleAr" pInputText type="text" formControlName="ar" 
                                       placeholder="مثل: المجموعات المميزة" class="w-full" dir="rtl" />
                            </div>
                        </div>
                    </div>

                    <!-- Section Subtitle -->
                    <div class="field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Section Subtitle</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="sectionSubtitle">
                            <div>
                                <label for="subtitleEn" class="block text-xs text-gray-600 mb-1">English</label>
                                <input id="subtitleEn" pInputText type="text" formControlName="en" 
                                       placeholder="e.g., Discover Our Best" class="w-full" dir="ltr" />
                            </div>
                            <div>
                                <label for="subtitleAr" class="block text-xs text-gray-600 mb-1">العربية</label>
                                <input id="subtitleAr" pInputText type="text" formControlName="ar" 
                                       placeholder="مثل: اكتشف الأفضل" class="w-full" dir="rtl" />
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="description">
                            <div>
                                <label for="descEn" class="block text-xs text-gray-600 mb-1">English</label>
                                <textarea id="descEn" pInputTextarea formControlName="en" [rows]="3" 
                                          class="w-full" dir="ltr" 
                                          placeholder="Optional description"></textarea>
                            </div>
                            <div>
                                <label for="descAr" class="block text-xs text-gray-600 mb-1">العربية</label>
                                <textarea id="descAr" pInputTextarea formControlName="ar" [rows]="3" 
                                          class="w-full" dir="rtl" 
                                          placeholder="وصف اختياري"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Display Order & Tags -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="field">
                            <label for="displayOrder" class="block text-sm font-medium text-gray-700 mb-2">Display Order</label>
                            <input id="displayOrder" type="number" pInputText formControlName="displayOrder" class="w-full" />
                        </div>
                        <div class="field">
                            <label for="tags" class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                            <p-chips id="tags" formControlName="tags" 
                                     placeholder="Add tags (press Enter)" 
                                     class="w-full"></p-chips>
                        </div>
                    </div>

                </div>
            </p-tabPanel>

            <!-- Items Tab -->
            <p-tabPanel header="Items" leftIcon="pi pi-images">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Layout Items</h3>
                        <p-button label="Add Item" icon="pi pi-plus" (onClick)="addItem()"></p-button>
                    </div>

                    <div formArrayName="items" class="space-y-6">
                        @for (item of itemsArray.controls; track $index; let i = $index) {
                        <p-card [formGroupName]="i" class="relative">
                            <ng-template pTemplate="header">
                                <div class="flex justify-between items-center p-4 bg-gray-50">
                                    <h4 class="text-base font-medium">Item {{ i + 1 }}</h4>
                                    <p-button icon="pi pi-trash" severity="danger" [text]="true" 
                                              (onClick)="removeItem(i)" 
                                              [disabled]="itemsArray.length === 1"></p-button>
                                </div>
                            </ng-template>

                            <div class="grid grid-cols-1 gap-4">
                                
                                <!-- Active Status -->
                                <div class="field">
                                    <div class="flex items-center">
                                        <p-inputSwitch formControlName="isActive" class="mr-3"></p-inputSwitch>
                                        <label class="text-sm font-medium text-gray-700">
                                            Item Active Status
                                        </label>
                                    </div>
                                </div>

                                <!-- Image Upload -->
                                <div class="field bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                                    <label class="flex items-center text-base font-semibold text-gray-800 mb-3">
                                        <i class="pi pi-image mr-2 text-blue-600"></i>
                                        Image Upload (Optional)
                                    </label>
                                    <p class="text-sm text-gray-600 mb-3">
                                        Click the area below or drag and drop an image
                                    </p>
                                    <app-upload-files
                                        [index]="i"
                                        [control]="item.get('image')!"
                                        [multiple]="false"
                                        [filesServer]="item.get('image')?.value"
                                        [accept]="'image/*'">
                                    </app-upload-files>
                                </div>

                                <!-- Video Upload -->
                                <div class="field bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
                                    <label class="flex items-center text-base font-semibold text-gray-800 mb-3">
                                        <i class="pi pi-video mr-2 text-purple-600"></i>
                                        Video Upload (Optional)
                                    </label>
                                    <p class="text-sm text-gray-600 mb-3">
                                        Click the area below or drag and drop a video (If video is uploaded, it will be used instead of image)
                                    </p>
                                    <app-upload-files
                                        [index]="i + 1000"
                                        [control]="item.get('video')!"
                                        [multiple]="false"
                                        [filesServer]="item.get('video')?.value"
                                        [accept]="'video/*'">
                                    </app-upload-files>
                                    
                                    <!-- Video Autoplay Option -->
                                    @if (item.get('video')?.value) {
                                    <div class="mt-4 pt-4 border-t border-purple-300">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                                    Video Autoplay
                                                </label>
                                                <p class="text-xs text-gray-500">
                                                    Enable to start video automatically, disable to wait for user interaction
                                                </p>
                                            </div>
                                            <p-inputSwitch formControlName="videoAutoplay"></p-inputSwitch>
                                        </div>
                                    </div>
                                    }
                                </div>

                                <!-- Title -->
                                <div class="field">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title (Optional)</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" [formGroupName]="'title'">
                                        <input pInputText type="text" formControlName="en" 
                                               placeholder="English title" dir="ltr" />
                                        <input pInputText type="text" formControlName="ar" 
                                               placeholder="العنوان بالعربية" dir="rtl" />
                                    </div>
                                </div>

                                <!-- Description -->
                                <div class="field">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" [formGroupName]="'description'">
                                        <textarea pInputTextarea formControlName="en" [rows]="2" 
                                                  placeholder="English description" dir="ltr"></textarea>
                                        <textarea pInputTextarea formControlName="ar" [rows]="2" 
                                                  placeholder="الوصف بالعربية" dir="rtl"></textarea>
                                    </div>
                                </div>

                                <!-- Button Text & Link -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="field">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Button Text (Optional)</label>
                                        <div class="grid grid-cols-2 gap-2" [formGroupName]="'buttonText'">
                                            <input pInputText type="text" formControlName="en" 
                                                   placeholder="Shop Now" dir="ltr" />
                                            <input pInputText type="text" formControlName="ar" 
                                                   placeholder="تسوق الآن" dir="rtl" />
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Button Link (Optional)</label>
                                        <input pInputText type="text" formControlName="buttonLink" 
                                               placeholder="/products" class="w-full" />
                                    </div>
                                </div>

                            </div>
                        </p-card>
                        }
                    </div>

                    @if(itemsArray.length === 0) {
                    <div class="text-center py-8 text-gray-500">
                        <i class="pi pi-images text-4xl mb-4"></i>
                        <p>No items added. Click "Add Item" to start.</p>
                    </div>
                    }
                </div>
            </p-tabPanel>

            <!-- Grid Config Tab -->
            <p-tabPanel header="Grid Layout" leftIcon="pi pi-th-large">
                <div class="p-6">
                    <app-hero-grid-builder
                        [collectionsCount]="itemsArray.length"
                        [config]="heroLayoutForm.get('gridConfig')?.value"
                        (configChange)="onGridConfigChange($event)">
                    </app-hero-grid-builder>
                </div>
            </p-tabPanel>

        </p-tabView>
    </form>

    <!-- Footer Actions -->
    <div class="flex justify-end gap-3 mt-6 pt-6 border-t">
        <p-button label="Cancel" icon="pi pi-times" [text]="true" (onClick)="cancel()"></p-button>
        <p-button 
            [label]="isEditMode ? 'Update' : 'Create'" 
            icon="pi pi-check" 
            (onClick)="saveHeroLayout()"
            [loading]="loading()"></p-button>
    </div>

</div>

