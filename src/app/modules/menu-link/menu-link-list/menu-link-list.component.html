<div class="card">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>

    <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="left">
            <button pButton pRipple [label]="'menuLink.new' | translate" icon="pi pi-plus" class="p-button-success"
                (click)="openNew()"></button>
        </ng-template>
    </p-toolbar>

    <p-table #dt [value]="menuLinks()" [globalFilterFields]="['key','title']" [tableStyle]="{'min-width': '75rem'}" 
        [rowHover]="true" dataKey="_id" [loading]="loading()" styleClass="p-datatable-gridlines">
        <ng-template pTemplate="caption">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="pi pi-link text-2xl text-blue-600"></i>
                    <h5 class="m-0 text-xl font-semibold text-gray-800">{{ 'menuLink.manage' | translate }}</h5>
                </div>
                <p-iconField iconPosition="left" class="ms-auto">
                    <p-inputIcon>
                        <i class="pi pi-search"></i>
                    </p-inputIcon>
                    <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" [placeholder]="'common.search' | translate"
                        class="w-full sm:w-auto" />
                </p-iconField>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="key">{{ 'menuLink.key' | translate }} <p-sortIcon field="key"></p-sortIcon></th>
                <th pSortableColumn="title">{{ 'menuLink.titleLabel' | translate }} <p-sortIcon field="title"></p-sortIcon></th>
                <th pSortableColumn="type">{{ 'menuLink.type.label' | translate }} <p-sortIcon field="type"></p-sortIcon></th>
                <th pSortableColumn="status">{{ 'common.status' | translate }} <p-sortIcon field="status"></p-sortIcon></th>
                <th pSortableColumn="order">{{ 'menuLink.order' | translate }} <p-sortIcon field="order"></p-sortIcon></th>
                <th>{{ 'common.actions' | translate }}</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-menuLink>
            <tr>
                <td>
                    <code class="text-sm bg-gray-100 px-2 py-1 rounded">{{menuLink.key}}</code>
                </td>
                <td>
                    <div class="space-y-1">
                        <div class="font-semibold text-gray-900" dir="ltr">{{menuLink.title?.en || '-'}}</div>
                        <div class="text-sm text-gray-600" dir="rtl">{{menuLink.title?.ar || '-'}}</div>
                    </div>
                </td>
                <td>
                    <p-tag [value]="getTypeLabel(menuLink.type)"
                        [severity]="getTypeSeverity(menuLink.type)"></p-tag>
                </td>
                <td>
                    <p-tag [value]="getStatusLabel(menuLink.status)"
                        [severity]="getSeverity(menuLink.status)"></p-tag>
                </td>
                <td>{{menuLink.order}}</td>
                <td>
                    <div class="flex items-center justify-center gap-2">
                        <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success"
                            (click)="editMenuLink(menuLink)" [pTooltip]="'menuLink.editMenuLink' | translate" tooltipPosition="top"></button>
                        <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warn"
                            (click)="deleteMenuLink(menuLink)" [pTooltip]="'menuLink.deleteMenuLink' | translate" tooltipPosition="top"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="6" class="text-center p-4">{{ 'menuLink.noMenuLinksFound' | translate }}</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Menu Link Dialog -->
<p-dialog [(visible)]="menuLinkDialog" [style]="{width: '70rem'}" [breakpoints]="{'1199px': '85vw', '575px': '95vw'}"
    [header]="'menuLink.menuLinkDetails' | translate" [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">
        <form [formGroup]="menuLinkForm" class="space-y-6">
            <!-- Basic Information -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="pi pi-info-circle me-2 text-blue-600"></i>
                    {{ 'menuLink.basicInformation' | translate }}
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="field">
                        <label for="key" class="font-bold text-gray-700">{{ 'menuLink.keyLabel' | translate }} *</label>
                        <input id="key" pInputText type="text" formControlName="key" 
                            [placeholder]="'menuLink.keyPlaceholder' | translate" class="w-full" />
                        <small *ngIf="submitted && menuLinkForm.get('key')?.invalid" class="p-error">
                            {{ 'menuLink.keyRequired' | translate }}
                        </small>
                    </div>

                    <div class="field">
                        <label for="type" class="font-bold text-gray-700">{{ 'menuLink.typeLabel' | translate }} *</label>
                        <p-dropdown id="type" formControlName="type" [options]="typeOptions"
                            optionLabel="label" optionValue="value" [placeholder]="'menuLink.selectType' | translate" class="w-full"></p-dropdown>
                        <small *ngIf="submitted && menuLinkForm.get('type')?.invalid" class="p-error">
                            {{ 'menuLink.typeRequired' | translate }}
                        </small>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="field">
                        <label for="status" class="font-bold text-gray-700">{{ 'menuLink.statusLabel' | translate }}</label>
                        <p-dropdown id="status" formControlName="status" [options]="statusOptions"
                            optionLabel="label" optionValue="value" class="w-full"></p-dropdown>
                    </div>

                    <div class="field">
                        <label for="order" class="font-bold text-gray-700">{{ 'menuLink.orderLabel' | translate }} *</label>
                        <p-inputNumber id="order" formControlName="order" [min]="0" class="w-full"></p-inputNumber>
                        <small *ngIf="submitted && menuLinkForm.get('order')?.invalid" class="p-error">
                            {{ 'menuLink.orderRequired' | translate }}
                        </small>
                    </div>
                </div>

                <!-- Title -->
                <div class="field mb-4">
                    <label class="font-bold text-gray-700 mb-3 block">{{ 'menuLink.titleLabelForm' | translate }} *</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="title">
                        <div>
                            <label for="titleEn" class="block text-sm text-gray-600 mb-1">{{ 'common.english' | translate }}</label>
                            <input id="titleEn" pInputText type="text" formControlName="en" required
                                [placeholder]="'menuLink.titleEnPlaceholder' | translate" class="w-full" dir="ltr" />
                            <small *ngIf="submitted && menuLinkForm.get('title.en')?.invalid" class="p-error">
                                {{ 'menuLink.titleEnRequired' | translate }}
                            </small>
                        </div>
                        <div>
                            <label for="titleAr" class="block text-sm text-gray-600 mb-1">{{ 'common.arabic' | translate }}</label>
                            <input id="titleAr" pInputText type="text" formControlName="ar" required
                                [placeholder]="'menuLink.titleArPlaceholder' | translate" class="w-full" dir="rtl" />
                            <small *ngIf="submitted && menuLinkForm.get('title.ar')?.invalid" class="p-error">
                                {{ 'menuLink.titleArRequired' | translate }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Link Configuration -->
            <div class="bg-blue-50 p-4 rounded-lg" *ngIf="getType === 'text'">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="pi pi-link me-2 text-blue-600"></i>
                    {{ 'menuLink.textLinkConfiguration' | translate }}
                </h3>
                <div class="field">
                    <label for="url" class="font-bold text-gray-700">{{ 'menuLink.url' | translate }} *</label>
                    <input id="url" pInputText type="text" formControlName="url"
                        [placeholder]="'menuLink.urlPlaceholder' | translate" class="w-full" />
                    <small *ngIf="submitted && menuLinkForm.get('url')?.invalid" class="p-error">
                        {{ 'menuLink.urlRequired' | translate }}
                    </small>
                </div>
            </div>

            <!-- Dropdown Configuration -->
            <div class="bg-green-50 p-4 rounded-lg" *ngIf="getType === 'dropdown'">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="pi pi-list me-2 text-green-600"></i>
                    {{ 'menuLink.dropdownConfiguration' | translate }}
                </h3>
                <ng-container formGroupName="dropdownConfig">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="field">
                            <label for="apiUrl" class="font-bold text-gray-700">{{ 'menuLink.apiUrl' | translate }} *</label>
                            <input id="apiUrl" pInputText type="text" formControlName="apiUrl"
                                [placeholder]="'menuLink.apiUrlPlaceholder' | translate" class="w-full" />
                            <small *ngIf="submitted && menuLinkForm.get('dropdownConfig.apiUrl')?.invalid" class="p-error">
                                {{ 'menuLink.apiUrlRequired' | translate }}
                            </small>
                        </div>
                        <div class="field">
                            <label for="method" class="font-bold text-gray-700">{{ 'menuLink.method' | translate }}</label>
                            <p-dropdown id="method" formControlName="method" [options]="methodOptions"
                                optionLabel="label" optionValue="value" class="w-full"></p-dropdown>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="field">
                            <label for="valueField" class="font-bold text-gray-700">{{ 'menuLink.valueField' | translate }} *</label>
                            <input id="valueField" pInputText type="text" formControlName="valueField"
                                [placeholder]="'menuLink.valueFieldPlaceholder' | translate" class="w-full" />
                            <small *ngIf="submitted && menuLinkForm.get('dropdownConfig.valueField')?.invalid" class="p-error">
                                {{ 'menuLink.valueFieldRequired' | translate }}
                            </small>
                        </div>
                        <div class="field">
                            <label for="urlTemplate" class="font-bold text-gray-700">{{ 'menuLink.urlTemplate' | translate }} *</label>
                            <input id="urlTemplate" pInputText type="text" formControlName="urlTemplate"
                                [placeholder]="'menuLink.urlTemplatePlaceholder' | translate" class="w-full" />
                            <small *ngIf="submitted && menuLinkForm.get('dropdownConfig.urlTemplate')?.invalid" class="p-error">
                                {{ 'menuLink.urlTemplateRequired' | translate }}
                            </small>
                        </div>
                    </div>

                    <div class="field">
                        <label class="font-bold text-gray-700 mb-3 block">{{ 'menuLink.labelFields' | translate }} *</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" formGroupName="labelField">
                            <div>
                                <label for="labelFieldEn" class="block text-sm text-gray-600 mb-1">{{ 'menuLink.englishField' | translate }}</label>
                                <input id="labelFieldEn" pInputText type="text" formControlName="en"
                                    [placeholder]="'menuLink.englishFieldPlaceholder' | translate" class="w-full" dir="ltr" />
                                <small *ngIf="submitted && menuLinkForm.get('dropdownConfig.labelField.en')?.invalid" class="p-error">
                                    {{ 'menuLink.englishFieldRequired' | translate }}
                                </small>
                            </div>
                            <div>
                                <label for="labelFieldAr" class="block text-sm text-gray-600 mb-1">{{ 'menuLink.arabicField' | translate }}</label>
                                <input id="labelFieldAr" pInputText type="text" formControlName="ar"
                                    [placeholder]="'menuLink.arabicFieldPlaceholder' | translate" class="w-full" dir="ltr" />
                                <small *ngIf="submitted && menuLinkForm.get('dropdownConfig.labelField.ar')?.invalid" class="p-error">
                                    {{ 'menuLink.arabicFieldRequired' | translate }}
                                </small>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </form>
    </ng-template>
    <ng-template pTemplate="footer">
        <div class="flex justify-end gap-2">
            <p-button [label]="'common.cancel' | translate" severity="danger" icon="pi pi-times" (click)="hideDialog()"></p-button>
            <p-button [label]="'common.save' | translate" type="submit" severity="success" icon="pi pi-check" [disabled]="menuLinkForm.invalid"
                (click)="saveMenuLink()"></p-button>
        </div>
    </ng-template>
</p-dialog>

