<div class="upload-container">
    <!-- Upload Statistics -->
    <div class="mb-4" *ngIf="selectedFiles.length > 0 && overallProgress !== 100">
      <div class="flex justify-between items-center mb-2">
        <span class="text-sm font-medium">Upload Progress</span>
        <span class="text-sm text-gray-500">
          {{ uploadStats.uploaded }}/{{ uploadStats.total }} files completed
        </span>
      </div>
      <p-progressBar [value]="overallProgress" [showValue]="true"></p-progressBar>
    </div>
  
    <!-- Upload Area -->
    <div class="flex items-center justify-center w-full max-w-6xl mx-auto mb-6">
      <label
        for="dropzone-file"
        class="flex flex-col items-center justify-center w-full border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors"
        [class.h-28]="multiple || selectedFiles.length === 0"
        [class.h-40]="!multiple && selectedFiles.length > 0"
        [class.border-blue-400]="isUploading"
        [class.bg-blue-50]="isUploading"
        [class.border-green-400]="!multiple && selectedFiles.length > 0 && selectedFiles[0].uploaded"
        [class.bg-green-50]="!multiple && selectedFiles.length > 0 && selectedFiles[0].uploaded"
      >
        <div class="flex flex-col items-center justify-center p-6">
          <!-- Single File Display -->
          @if (!multiple && selectedFiles.length > 0) {
            <div class="flex items-center gap-4 mb-4">
              <!-- File Preview -->
              <div class="flex-shrink-0">
                @if (selectedFiles[0].type.includes("image") && selectedFiles[0].content) {
                  <img
                    class="h-16 w-16 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
                    [src]="selectedFiles[0].content | safe"
                    [alt]="selectedFiles[0].name"
                  />
                } @else if (selectedFiles[0].type.includes("video") && selectedFiles[0].content) {
                  <video class="h-16 w-16 rounded-lg border-2 border-gray-200 shadow-sm" [poster]="selectedFiles[0].content | safe">
                    <source [src]="selectedFiles[0].content | safe" type="video/mp4" />
                  </video>
                } @else if (selectedFiles[0].type.includes("audio") && selectedFiles[0].content) {
                  <div class="h-16 w-16 flex items-center justify-center bg-purple-100 rounded-lg border-2 border-gray-200 shadow-sm">
                    <i class="pi pi-volume-up text-purple-600 text-2xl"></i>
                  </div>
                } @else {
                  <div class="h-16 w-16 flex items-center justify-center bg-gray-100 rounded-lg border-2 border-gray-200 shadow-sm">
                    <i [class]="selectedFiles[0].iconClass" class="text-3xl text-gray-600"></i>
                  </div>
                }
              </div>
              
              <!-- File Info -->
              <div class="flex-1 min-w-0">
                <div class="font-semibold text-sm text-gray-900 mb-1 truncate">{{ selectedFiles[0].name }}</div>
                <div class="text-xs text-gray-500 mb-2">{{ selectedFiles[0].size }}</div>
                
                <!-- Status -->
                @if (selectedFiles[0].uploading) {
                  <div class="flex items-center gap-2">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                      <i class="pi pi-spin pi-spinner mr-1"></i>
                      Uploading...
                    </span>
                  </div>
                } @else if (selectedFiles[0].uploaded) {
                  <div class="flex items-center gap-2">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
                      <i class="pi pi-check mr-1"></i>
                      Uploaded Successfully
                    </span>
                  </div>
                } @else if (selectedFiles[0].error) {
                  <div class="flex items-center gap-2">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-red-100 text-red-800">
                      <i class="pi pi-exclamation-triangle mr-1"></i>
                      {{ selectedFiles[0].error }}
                    </span>
                  </div>
                }
              </div>
              
              <!-- Replace Button -->
              <button 
                type="button"
                class="p-2 rounded-full hover:bg-gray-200 text-gray-600 transition-colors"
                (click)="replaceFile()"
                [disabled]="selectedFiles[0].uploading"
                title="Replace File"
              >
                <i class="pi pi-refresh text-lg"></i>
              </button>
            </div>
            
            <!-- Progress Bar for Single File -->
            @if (selectedFiles[0].uploading || (selectedFiles[0].progress > 0 && selectedFiles[0].progress < 100)) {
              <div class="w-full mb-4">
                <div class="flex justify-between items-center mb-1">
                  <span class="text-xs text-gray-600">Upload Progress</span>
                  <span class="text-xs text-gray-600">{{ selectedFiles[0].progress }}%</span>
                </div>
                <p-progressBar 
                  [value]="selectedFiles[0].progress" 
                  [showValue]="false"
                  styleClass="h-2"
                ></p-progressBar>
              </div>
            }
            
            <p class="text-xs text-gray-500 text-center">
              Click to replace file or drag and drop a new one
            </p>
          } @else {
            <!-- Default Upload State -->
            <svg
              class="w-8 h-8 mb-4 text-gray-500"
              [class.text-blue-500]="isUploading"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 20 16"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"
              />
            </svg>
            <p class="mb-2 text-sm text-gray-500">
              <span class="font-semibold">Click to upload</span> or drag and drop
            </p>
            <p class="text-xs text-gray-500" *ngIf="isUploading">
              Uploading {{ uploadStats.uploading }} file(s)...
            </p>
          }
        </div>
        <input
          id="dropzone-file"
          type="file"
          class="hidden"
          [multiple]="multiple"
          [accept]="accept"
          (change)="onFilesSelected($event)"
          [disabled]="isUploading"
        />
      </label>
    </div>
  
    <!-- Files List (Only show for multiple files) -->
    <div *ngIf="multiple" class="flex flex-wrap p-2 gap-4 w-full max-h-[600px] overflow-y-auto relative grid md:grid-cols-2 lg:grid-cols-3 ">
      @for (file of selectedFiles; track file.id) {
        <div
          class="flex flex-col w-full relative p-3 border-solid border-[1px] rounded-lg transition-all duration-200"
          [class.border-gray-200]="!file.uploaded && !file.error"
          [class.border-green-300]="file.uploaded"
          [class.bg-green-50]="file.uploaded"
          [class.border-red-300]="file.error"
          [class.bg-red-50]="file.error"
          [class.border-blue-300]="file.uploading"
          [class.bg-blue-50]="file.uploading"
        >
          <!-- File Header -->
          <div class="flex items-center gap-3 max-w-full">
            <!-- File Icon/Preview -->
            <div class="card-image flex-shrink-0">
              @if (file.type.includes("image") && file.content) {
                <img
                  class="h-12 w-12 object-cover rounded border"
                  [src]="file.content | safe"
                  [alt]="file.name"
                />
              } @else if (file.type.includes("video") && file.content) {
                <video class="h-12 w-12 rounded border" [poster]="file.content | safe">
                  <source [src]="file.content | safe" type="video/mp4" />
                </video>
              } @else if (file.type.includes("audio") && file.content) {
                <div class="h-12 w-12 flex items-center justify-center bg-purple-100 rounded border">
                  <i class="pi pi-volume-up text-purple-600 text-xl"></i>
                </div>
              } @else {
                <i [class]="file.iconClass" class="text-3xl"></i>
              }
            </div>
  
            <!-- File Info -->
            <div class="flex-1">
              <div class="font-semibold text-sm max-w-20 truncate mb-1">{{ file.name }}</div>
              <div class="text-xs text-gray-500 mb-1">{{ file.size }}</div>
              
              <!-- Status -->
              <div class="flex items-center gap-2">
                @if (file.uploading) {
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                    <i class="pi pi-spin pi-spinner mr-1"></i>
                    Uploading...
                  </span>
                }
                @if (file.uploaded) {
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
                    <i class="pi pi-check mr-1"></i>
                    Uploaded
                  </span>
                }
                @if (file.error) {
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-red-100 text-red-800">
                    <i class="pi pi-exclamation-triangle mr-1"></i>
                    {{ file.error }}
                  </span>
                }
              </div>
            </div>
  
            <!-- Actions -->
            <div class="flex items-center gap-2">
              @if (file.error) {
                <button 
                  class="p-1 rounded-full hover:bg-blue-100 text-blue-600 transition-colors border-transparent cursor-pointer h-6 w-6 flex items-center justify-center"
                  (click)="retryUpload(file.id)"
                  title="Retry Upload"
                >
                  <i class="pi pi-refresh text-sm"></i>
                </button>
              }
              
              <button 
                class="p-1 rounded-full hover:bg-green-100 text-green-600 transition-colors border-transparent cursor-pointer h-6 w-6 flex items-center justify-center"
                (click)="downloadFile(file.id)"
                [disabled]="file.uploading"
                title="Download"
              >
                <i class="pi pi-download text-sm"></i>
              </button>
              
              <button 
                class="p-1 rounded-full hover:bg-red-100 text-red-600 transition-colors border-transparent cursor-pointer h-6 w-6 flex items-center justify-center"
                (click)="removeFile(file.id)"
                [disabled]="file.uploading"
                title="Remove"
              >
                <i class="pi pi-times text-sm"></i>
              </button>
            </div>
          </div>
          @if (isDescription) {
          <div class="mt-2 w-full" >
            <textarea class="w-full px-2" [(ngModel)]="file.description" rows="2" ></textarea>
          </div>
          }
          <!-- Progress Bar -->
          @if (file.uploading || (file.progress > 0 && file.progress < 100)) {
            <div class="w-full">
              <div class="flex justify-between items-center mb-1">
                <span class="text-xs text-gray-600">Progress</span>
                <span class="text-xs text-gray-600">{{ file.progress }}%</span>
              </div>
              <p-progressBar 
                [value]="file.progress" 
                [showValue]="false"
                styleClass="h-2"
              ></p-progressBar>
            </div>
          }
  
          <!-- Audio Player for Audio Files -->
          @if (file.type.includes("audio") && file.content && file.uploaded) {
            <div class="mt-3">
              <audio controls class="w-full">
                <source [src]="file.content | safe" type="audio/mpeg" />
                <source [src]="file.content | safe" type="audio/ogg" />
                Your browser does not support the audio element.
              </audio>
            </div>
          }
        </div>
      }
      <!-- <div class="flex justify-center items-center p-2 sticky bottom-0 left-0 right-0 w-full" *ngIf="files.length > 0">
        <button pButton label="Upload" [disabled]="loadingExport || isUploading" [loading]="loadingExport" (click)="exportFiles()"></button>
      </div> -->
    </div>
  
    <!-- Error Display -->
    <!-- @if (showError) {
      <div class="mt-2 text-sm text-red-600">
        @if (isRequired) {
          This field is required.
        }
      </div>
    } -->
  </div>
  
  <!-- Toast Messages -->
  <p-toast></p-toast>